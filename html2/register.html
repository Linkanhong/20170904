<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> 
  <meta name="keywords" content="店装帮">
  <meta name="description" content="店装帮，让店装更便捷" />
	<title>注册</title>
	<link rel="shortcut icon" href="favicon.ico"/>
	
	<link href="css/bootstrap.min.css" rel="stylesheet">
  	<link rel="stylesheet" type="text/css" href="css/Payeng.css">
  	
	<link rel="stylesheet" type="text/css" href="css/common.css" />
	<link rel="stylesheet" type="text/css" href="css/register.css" />
  	<script src="js/jquery-3.2.0.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	
	<script type="text/javascript" src="js/jquery.validate.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
	<script type="text/javascript" src="js/jquery.SuperSlide.2.1.1.js"></script>

</head>

<body class="p-bodyR">
<!--头部-->
<div class="lr_header">
	<div class="lr_header_wrap wrap" >
		<h1 class="logo"><a href="index.html"><img src="img/logo.png" alt="店装帮"></a></h1>
		<a href="index.html" style="float:right;color:#0085d0;margin-top:38px;">返回首页</a>
	</div>
</div>
<!-- 注册框  -->
<div class="register-main">
	<div class="register-wrap">
		<h2>新用户注册</h2>
		<div class="register-form">
			<form action="" class="register-form-con" id="register">
				<!--  
				<div><input type="text" name="userName" id="userName" placeholder="邮箱地址" maxlength="32" /></div>
				-->
				<div>
					<input type="text" name="phone" id="phone" placeholder="请输入手机号码" maxlength="11"  class="p-btnNumber" />
					<sub class="p-red p-sub3">手机号码不能为空</sub>
				</div>
				<div>
					<input type="text" name="phoneYzm" id="phoneYzm" placeholder="请输入验证码" maxlength="6" style="width:198px;"  class="btn-number p-btnNumber2" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^0-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^0-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"  />
					<a href="javascript:registSMS()" class="phone_yzm send">获取验证码</a>
					<div class="clearfix"></div>
					<sub class="p-red p-sub3">请输入验证码</sub>
				</div>
				<div><input type="passWord" name="passWord" id="passWord" class="passWord1 p-passWord1" placeholder="请输入密码" maxlength="16" minlength="6" /><sub class="p-red p-sub3">密码输入不能少于6位数</sub></div>
				<div>
					<input type="passWord" name="passWord2" id="passWord2" class="passWord2 p-passWord2" placeholder="请再次输入密码" maxlength="16" minlength="6" />
					<sub class="p-red p-sub3">两次输入密码不一致</sub>
				</div>
				<div>
					<input type="text" name="picYzm" class="p-picYzm" id="picYzm" placeholder="请输入右侧图形码" maxlength="4" style="width:198px;" />
					<a href="javascript:void(0)" title="点击图片刷新校验码" class="p-validate"><img src="img/pic_yzm2.png" class="p-validate-img"></a>
					<div class="clearfix"></div>
					<sub class="p-red p-sub3">请输入图片验证码</sub>
				</div>
				<div class="clearfix p-div p-div2">
					<ul class="list-inline">
						<li><input type="radio" id="statue" name="statue" value="1" checked="checked"/>需求方</li>
						<li><input type="radio" id="statue" name="statue" value="2"/>服务方</li>
					</ul>
				</div>
				<div class="agreement p-div p-div3">
					<p><input type="checkbox" checked="checked" name="agree" id="agree" class="agree-chose">我已阅读并同意
						<a href="regulations-register.html" target="_blank">《店装帮使用协议》</a>
					</p>
				</div>
				<input type="button" value="注册" class="register-btn btn02" onclick="register();" />
				<p style="text-align:right;margin-top:10px;color:#d2d2d2;"><a href="login.html" class="color01">已有账户去登录</a></p>
			</form>
		</div>
	</div>
</div>
<script type="text/javascript" src="js/Payeng.js"></script>
<script>
		$(function(){
			//验证码刷新
			$(".p-validate-img").attr("src","/DZBang_entrance/code.do?t=genTimestamp()?flag="+Math.random()); 
			$('.p-validate').click(function(event) {

				$(".p-validate-img").attr("src","/DZBang_entrance/code.do?t=genTimestamp()?flag="+Math.random()); 

			});

			//发接任务切换
			(function(){
				$('.task ul li span').click(function(){
					$(this).addClass('choosed').parent().siblings().children('span').removeClass('choosed');
				});
			})();
			//表单验证
			(function(){
				// 邮箱验证
				jQuery.validator.addMethod("isMobile", function(value, element) {
					// var length = value.length;
					// var mobile = /^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;
					var mobile = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
					return this.optional(element) || mobile.test(value);
				}, "请正确填写您的邮箱地址");

				$('#register').validate({
					//验证成功后执行
					submitHandler : function (form) {
						
					},
					rules : {
						userName : {
							required : true,
							//minlength : 11,
							isMobile:true,
							email:true,
							remote:'/',  //验证用户名是否已存在
						},
						passWord : {
							required : true,
							minlength : 6,
							//验证用户名是否已存在
							remote : {
								url : '/',    //提交后台的地址
								type : 'POST',
								dataType : 'json',
								data : {
									userName : function () {
										return $('#userName').val();  //获取输入的内容
									},
								},
							},
						},
						pciYzm : {
							required : true,
							minlength : 4
						}
					},
					messages : {
						userName : {
							required : '帐号不得为空！',
							//minlength : '帐号不得小于11位！',
							isMobile : '请正确填写您的手机号码',
							// email:'请输入正确的邮箱地址！',
							remote : '该帐号被被占用！'   //验证用户名是否已存在
						},
						passWord : {
							required : '密码不得为空！',
							minlength : '密码不得小于6位！',
							remote : '帐号或密码不正确！' //验证账号与密码是否一致的提示
						},
						picYzm : {
							required : '验证码不能为空',
							minlength : '验证码不能低于4位'
						}
					},
					/*错误提示信息*/
					errorElement: 'sub',
					success: function(label) {
						label.text('').remove();
					}
				});

			})();


		})
		
		//注册短信验证码
		function registSMS(){
			var phone = $("#phone").val();
			if(phone == ''){
				window.wxc.xcConfirm("手机号码不能为空",window.wxc.xcConfirm.typeEnum.error);
				return;
			}
			$.ajax({
				url: '/DZBang_entrance/smsCode/registerSMSCode.do',
				type: 'post',
		    	data: {phone:phone,tm:new Date().getTime()},
		    	dataType: 'json',
				cache: false,
				'success': function(data){
					if(data.result == "success"){
						window.wxc.xcConfirm("短信发送成功",window.wxc.xcConfirm.typeEnum.success);
					}else if(data.result == "error"){
						window.wxc.xcConfirm("短信发送失败",window.wxc.xcConfirm.typeEnum.error);
					}else{
						window.wxc.xcConfirm("短信发送异常",window.wxc.xcConfirm.typeEnum.error);
					}
				},
				'error':function(data){
					window.wxc.xcConfirm("短信发送失效",window.wxc.xcConfirm.typeEnum.error);
				}
			});
		}
		
		$.fn.serializeObject = function()  
		{  
		   var o = {};  
		   var a = this.serializeArray();  
		   $.each(a, function() {  
		       if (o[this.name]) {  
		           if (!o[this.name].push) {  
		               o[this.name] = [o[this.name]];  
		           }  
		           o[this.name].push(this.value || '');  
		       } else {  
		           o[this.name] = this.value || '';  
		       }  
		   });  
		   return o;  
		};
		
		//注册
		function register(){
	        //var data = $("#form1").serializeArray(); //自动将form表单封装成json
	        
	        var jsonuserinfo = $('#register').serializeObject();
	        
	        var data = jsonuserinfo;
	        
	        $.ajax({
	    		url: '/DZBang_entrance/happuser/register.do',
	    		type: 'post',
	        	data: data,
	        	dataType: 'json',
	    		cache: false,
	    		'success': function(data){
	    			if("success" == data.result){
	    				window.wxc.xcConfirm("注册成功",window.wxc.xcConfirm.typeEnum.success,
	    						{onClose: function(){
	    							window.location.href= "login.html?flag="+Math.random();
	    						}},
	    						{onOk: function(){
	    							window.location.href= "login.html?flag="+Math.random();
	    						}});
	    			}else if("usererror" == data.result){
	    				window.wxc.xcConfirm("用户名或密码有误",window.wxc.xcConfirm.typeEnum.error);
	    			}else if("codeError" == data.result){
	    				window.wxc.xcConfirm("图形验证码输入有误",window.wxc.xcConfirm.typeEnum.error);
	    			}else if("phoneYzmError" == data.result){
	    				window.wxc.xcConfirm("短信验证码输入有误",window.wxc.xcConfirm.typeEnum.error);
	    			}else if("notsendSMS" == data.result){
	    				window.wxc.xcConfirm("没有发送短信",window.wxc.xcConfirm.typeEnum.error);
	    			}else if("ishavephone" == data.result){
	    				window.wxc.xcConfirm("该手机号码已注册",window.wxc.xcConfirm.typeEnum.error);
	    			}else{
	    				window.wxc.xcConfirm("缺少参数,注册失败",window.wxc.xcConfirm.typeEnum.error);
	    			}
	    		},
	    		'error':function(data){
	    			window.wxc.xcConfirm("注册失败",window.wxc.xcConfirm.typeEnum.error);
	    		},

	    	});
	}

	$(function(){
		var num = 0;
		$('.agree-chose').click(function(event) {
			if (num == 0) {
				$(this).attr('checked', '');
				$('.register-btn').removeAttr('onclick');
				$('.register-btn').css({background: '#bebebe'});
				num =1;
			}
				
			else if (num == 1) {
				$(this).removeAttr('checked');
				$('.register-btn').css({background: '#fdaf17'});
				$('.register-btn').attr('onclick', 'register();');			
				num = 0;				
			};
		});
	});
	</script>
</body>
</html>