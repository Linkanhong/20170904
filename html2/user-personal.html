<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> 
  <meta http-equiv="Expires" content="0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-control" content="no-cache">
  <meta http-equiv="Cache" content="no-cache">
  <meta name="keywords" content="店装帮">
  <meta name="description" content="店装帮，让店装更便捷" />
  <title>个人认证</title>
  <link rel="shortcut icon" href="favicon.ico"/>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/Payeng.css">
  <link rel="stylesheet" type="text/css" href="style.css">

  <script src="js/jquery-2.1.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
	<link href="datecss/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
	<script type="text/javascript" src="datejs/bootstrap-datetimepicker.js" charset="UTF-8"></script>
	<script type="text/javascript" src="datejs/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
  <link rel="stylesheet" type="text/css" href="css/user.css">

</head>
<body class="p-user">
  <header class="t-header">     
    <div class="container-fluid p-nopadding t-top p-container">
        <span><a href="index.html"><img src="img/logo.png" alt="店装帮"></a><em>让店装更便捷</em></span>
        <ul class="list-inline pull-right p-nopadding t-ul">
            <li id="index_head"><a href="login.html">登录</a><a href="register.html">免费注册</a></li>
            <li class="p-paddingLeft8" id="showsysout"></li>
        </ul>            
    </div>   
  </header><!--end headr -->

  <nav class="navbar navbar-default t-nomargin t-navbar">
    <div class="container-fluid p-container p-nopadding ">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse p-nopadding" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav t-width100">
          <li class="dropdown t-background t-li">
            <a href="#" class="dropdown-toggle t-fontcolor6 c-dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><img src="img/nav-icon.png" alt="" class="t-por3 c-navicon">全部导航<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="index.html">首页<span class="icon-navshouye pull-right p-iconBefore"></span></a></li>
              <li role="separator" class="divider"></li>
              <li><a href="seller-list.html">找需求<span class="icon-navchuangkezhongxin pull-right p-iconBefore"></span></a></li>
              <li role="separator" class="divider"></li>
              <li><a href="stuff.html">找材料<span class="icon-navzhaocailiao pull-right p-iconBefore"></span></a></li>
              <li role="separator" class="divider"></li>
              <li><a href="maker.html">创客中心<span class="icon-navchuangkezhongxin pull-right p-iconBefore"></span></a></li>
            </ul>
          </li>
          <li class="p-active"><a href="user-information.html">账户设置</a></li>
          <li><a href="user-order.html">项目管理</a></li>
          <li><a href="user-notice.html">消息中心</a></li>
          <li></li>
        </ul>
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav><!--end nav -->  

  <div class="p-container clearfix p-marginTop">
    <div class="col-sm-2 p-col-sm-2 all p-nopadding">
      <ul>
          <li>
                <span class="p-fontcolor"><span class="glyphicon glyphicon-play"></span>账户管理</span>
                <ul>
                  <li><a href="user-information.html">基本信息<img src="img/member-icon5.png" alt="" class="p-mymember1"></a></li>
                  <li class="p-active2"><a href="user-authentication.html">身份认证<img src="img/member-icon6.png" alt="" class="p-mymember1"></a></li>
                  <li><a href="user-security.html">安全级别<img src="img/member-icon7.png" alt="" class="p-mymember1"></a></li>
                  <li><a href="user-modify-password.html">修改密码<img src="img/member-icon8.png" alt="" class="p-mymember1"></a></li>
                </ul>
          </li>
          <li class="current">
                <span class="p-fontcolor"><span class="glyphicon glyphicon-play"></span>项目管理</span>
                <ul>
                  <li><a href="user-order.html">我的订单<img src="img/member-icon3.png" alt="" class="p-mymember1"></a></li>
                  <li><a href="user-collection.html">我的收藏<img src="img/member-icon4.png" alt="" class="p-mymember1"></a></li>
                </ul>
          </li>
<!--           <li class="current">
                <span class="p-fontcolor"><span class="glyphicon glyphicon-play"></span>会员中心</span>
                <ul>
                  <li><a href="uese-myMember.html">我的会员<img src="img/member-icon1.png" alt="" class="p-mymember1"></a></li>
                  <li><a href="uese-growUp.html">成长体系<img src="img/member-icon2.png" alt="" class="p-mymember1"></a></a></li>
                </ul>
          </li> -->
          <li class="current">
                <span class="p-fontcolor"><span class="glyphicon glyphicon-play"></span>通知<span class="p-badge"> (1)</span></span>
                <ul>
                  <li><a href="user-notice.html">系统通知<img src="img/member-icon9.png" alt="" class="p-mymember1"></a></li>
                  <li><a href="user-service.html">服务通知<img src="img/member-icon10.png" alt="" class="p-mymember1"></a></li>
                  <li><a href="user-transaction.html">交易通知<img src="img/member-icon11.png" alt="" class="p-mymember1"></a></li>
                </ul>
          </li>
        </ul>    
    </div>
    <!--end left -->

	<div class="col-sm-10 p-col-sm-10 p-background3 p-padding3 p-width2">
	    <ul class="p-bdb p-paddb p-marg3 list-inline p2-marginB3">
			<li class="p-h3 p-bdl2">认证状态</li>
			<li class="p-dbl3"> <span class="glyphicon glyphicon-user p-fontcolor8 p-h4"></span><span class="p2-poa">&nbsp; 未认证</span></li>
		</ul>
		<p class="p-danger p2-marginB4">注：完善身份认证即可发布需求，认证需要1-3个工作日</p>
		<form class="form-horizontal p2-marginB5" id="idcardFrom">
		  <div class="form-group p-input">
		    <label for="inputEmail3" class="col-sm-3 control-label"><span class="p-red p-marginRight p-paddingTop1">*</span>姓名: </label>
		    <div class="col-sm-8">
		      <input type="text" class="form-control" id="name" name="name" maxlength="10">
		    </div>
		  </div>
		  <div class="form-group p-input">
		    <label for="inputEmail3" class="col-sm-3 control-label"><span class="p-red p-marginRight p-paddingTop1">*</span>身份证号码: </label>
		    <div class="col-sm-8">
		      <input type="text" class="form-control" id="idcard" name="idcard" maxlength="18">
		    </div>
		  </div>
		  <div class="form-group p-input">
		    <label for="inputEmail3" class="col-sm-3 control-label"><span class="p-red p-marginRight p-paddingTop1">*</span>身份证地址: </label>
		    <div class="col-sm-8">
		      <input type="text" class="form-control" id="address" name="address" maxlength="30">
		    </div>
		  </div>		  
		  <div class="form-group p-input p2-bdb">
		    <label for="inputEmail3" class="col-sm-3 control-label"><span class="p-red p-marginRight p-paddingTop1">*</span>身份证正照: </label>
		    <div class="col-sm-8">
				    <div class="task2-img p2-task"></div>
				    <a href="#" class="p-file btn p-btnwidth p-style p-pdfFile p2-file">+添加附件	
				    	<input type="file" name="idcard_positive" id="idcard_positive" placeholder="" class="p2-file1">
				    </a>
			    <div class="clearfix"></div>		    	
		      <sub class="p-fontcolor8">附件大小请勿超过2M ,图片格式支持JPG、GIF、PNG</sub>
		    </div>
		  </div>
<!-- 		  <div class="form-group text-left p-input">
		    <label for="inputEmail3" class="col-sm-3 control-label"><span class="p-red p-marginRight p-paddingTop1">*</span>有效期限: </label>
		    <div class="col-sm-9">
		   	  <input type="text" name="begin_date" id="begin_date" value="" class="p-btnstyle3 p-marb3 form_date" placeholder="年/月/日" /><span class="p-fontcolor6 p-paddl">开始</span> <br>
			    <script type="text/javascript">	           
		  			  $('.form_date').datetimepicker({
		  		            language: 'zh-CN',
		  		            format: 'yyyy-mm-dd',
		  		            weekStart: 1,
		  		            todayBtn: 1,
		  		            autoclose: 1,
		  		            todayHighlight: 1,
		  		            startView: 2,
		  		            minView: 2,
		  		          	initialDate: new Date(),
		  		            forceParse: 0
		  		        });
	           </script>

		   	  <input type="text" name="end_date" id="end_date" value="" class="p-btnstyle3" placeholder="年/月/日"/><span class="p-fontcolor6 p-paddl">为止</span>
			    <script type="text/javascript">	           
		  			  $('#end_date').datetimepicker({
		  		            language: 'zh-CN',
		  		            format: 'yyyy-mm-dd',
		  		            weekStart: 1,
		  		            todayBtn: 1,
		  		            autoclose: 1,
		  		            todayHighlight: 1,
		  		            startView: 2,
		  		            minView: 2,
		  		          	initialDate: new Date(),
		  		            forceParse: 0
		  		        });
	           </script>

		    </div>
		  </div> -->

		  <div class="form-group p-input">
		    <label for="" class="col-sm-3"></label>
		    <div class="col-sm-8">
		      <!-- <input type="text" class="form-control" id="idcard" name="idcard" maxlength="18"> -->
		      <a role="button" class="btn btn-primary p-submit">提交</a>
		    </div>
		  </div>

		  <!-- <a role="button" class="btn btn-primary p-submit">提交</a> -->
		</form>
		<div class="clearfix"></div>
	</div>
</div>
<div class="clearfix"></div><!-- /end -->


<div class="container-fluid footer" id="footer1">
</div><!-- /footer -->



<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/Payeng.js"></script>
<script>
		$.getJSON("/DZBang_entrance/userinfo/getLoginUserIdCard.do", function(data){
			//$("#id").val(data.id);
			$("#name").val(data.name);
			$("#idcard").val(data.idcard);
			$("#address").val(data.address);
			$("#begin_date").val(data.begin_date_str);
			$("#end_date").val(data.end_date_str);

		});
		
		$.fn.serializeObject = function()  
		{
		   var o = {};  
		   var a = this.serializeArray();  
		   $.each(a, function() {  
		       if (o[this.name]) {  
		           if (!o[this.name].push) {  
		               o[this.name] = [o[this.name]];  
		           }  
		           o[this.name].push(this.value || '');  
		       } else {  
		           o[this.name] = this.value || '';  
		       }  
		   });  
		   return o;  
		};
		
		//保存身份证信息
		function saveIdcard(){
	        var idcardinfo = $('#idcardFrom').serializeObject();
	        var data = idcardinfo;
	        
	        $.ajax({
	    		url: '/DZBang_entrance/userinfo/saveIdcard.do',
	    		type: 'post',
	        	data: data,
	        	dataType: 'json',
	    		cache: false,
	    		'success': function(data){
	    			if("success" == data.result){
	    				var id = $("#id").val();
	    				uploadImg();
	    			}else if("nologin" == data.result){
	    				window.wxc.xcConfirm("你好，你还未登录，请先登录",window.wxc.xcConfirm.typeEnum.error,
	    						{onClose: function(){
	    							window.location.href= "login.html?flag="+Math.random();
	    						}},
	    						{onOk: function(){
	    							window.location.href= "login.html?flag="+Math.random();
	    						}});
	    			}else if("ishave" == data.result){
	    				window.wxc.xcConfirm("你已提交，请勿重复提交",window.wxc.xcConfirm.typeEnum.error,
	    						{onClose: function(){
	    							window.location.href= "user-information.html"+"?flag="+Math.random();
	    						}},
	    						{onOk: function(){
	    							window.location.href= "user-information.html"+"?flag="+Math.random();
	    						}});
	    			}else if("isCheck" == data.result){
	    				window.wxc.xcConfirm("你审核通过，不需再提交信息",window.wxc.xcConfirm.typeEnum.error,
	    						{onClose: function(){
	    							window.location.href= "user-information.html"+"?flag="+Math.random();
	    						}},
	    						{onOk: function(){
	    							window.location.href= "user-information.html"+"?flag="+Math.random();
	    						}});
	    			}else{
	    				window.wxc.xcConfirm("保存失败，请重新提交",window.wxc.xcConfirm.typeEnum.error);
	    			}
	    		},
	    		'error':function(data){
	    			window.wxc.xcConfirm("保存失败，请重新提交",window.wxc.xcConfirm.typeEnum.error);
	    		}

	    	});
	}
		
		function uploadImg(){
			
			var formData = new FormData();
		    formData.append("imgFile", document.getElementById("idcard_positive").files[0]);
		    $.ajax({
		        url: "/DZBang_entrance/userinfo/uploadIdcardPositiveImg.do",
		        type: "POST",
		        data: formData,
		        /**
		        *必须false才会自动加上正确的Content-Type
		        */
		        contentType: false,
		        /**
		        * 必须false才会避开jQuery对 formdata 的默认处理
		        * XMLHttpRequest会对 formdata 进行正确的处理
		        */
		        processData: false,
		        success: function (data) {
		        	 
		            if (data.result == "success") {
		                window.wxc.xcConfirm("信息提交成功，请耐心等待审核结果",window.wxc.xcConfirm.typeEnum.success,
						{onClose: function(){
							window.location.href= "user-submit.html"+"?flag="+Math.random();
						}},
						{onOk: function(){
							window.location.href= "user-submit.html"+"?flag="+Math.random();
						}});

		            }
		            if (data.result == "error") {
		            	window.wxc.xcConfirm("文件上传失败",window.wxc.xcConfirm.typeEnum.error);
		            }
		            if (data.result == "tobig") {
		            	window.wxc.xcConfirm("上传文件太大了",window.wxc.xcConfirm.typeEnum.error);
		            }
		            if (data.result == "isnull") {
		            	window.wxc.xcConfirm("上传文件不能为空",window.wxc.xcConfirm.typeEnum.error);
		            }
		            if (data.result == "nologin") {
		            	window.wxc.xcConfirm("请先登录系统才能上传文件",window.wxc.xcConfirm.typeEnum.error);
		            }
		        },
		        error: function () {
		            window.wxc.xcConfirm("上传失败",window.wxc.xcConfirm.typeEnum.error);
		        }
		    });
		}	
	

	function Palert(){
		$(".p-submit").click(function(event) {
			var index =  $(".p-input").index();		
			if ($(".p-input:eq(0) input").val() == '') {
				 window.wxc.xcConfirm('请输入姓名',window.wxc.xcConfirm.typeEnum.confirm);
			}else if( $(".p-input:eq(1) input").val() == ''){
				window.wxc.xcConfirm('请输入身份证号码',window.wxc.xcConfirm.typeEnum.confirm);
			}else if( $(".p-input:eq(2) input").val() == ''){
				window.wxc.xcConfirm('请输入身份证地址',window.wxc.xcConfirm.typeEnum.confirm);
			}else if( $(".p-input:eq(3) input").val() == ''){
				window.wxc.xcConfirm('请添加附件',window.wxc.xcConfirm.typeEnum.confirm);
			}else{
				saveIdcard();
			};
			
		});
	};
	Palert();
	</script>
<script>
  $(function(){ 
    $('.all .p-fontcolor').click(function(e) {
          $(this).parent().toggleClass('current').siblings().addClass('current');
      });
  });  
</script>
<script>
  $.getJSON("/DZBang_entrance/happuser/getloginUser.do", function(data){
      if("" != data.name && null != data.name){
    	  $("#index_head").html('<a href="user-information.html" class="p-borderColor">'+data.nickname+'</a><a href="user-notice.html"><span class="p-fontcolor20">消息</span></a>');
      $("#showsysout").html("<a onclick='sysloginout();' >退出</ a>");

      }else{
    	  window.wxc.xcConfirm("你未登录，请先登录",window.wxc.xcConfirm.typeEnum.error,
  	            {onClose: function(){
  	              window.location.href= "login.html?flag="+Math.random();
  	            }},
  	            {onOk: function(){
  	              window.location.href= "login.html?flag="+Math.random();
  	            }});
      }
  });
  function sysloginout(){
	  window.wxc.xcConfirm("请确认是否注销？",window.wxc.xcConfirm.typeEnum.confirm,
	            {onOk: function(){
	            	$.ajax({
	          	      url: '/DZBang_entrance/syslogout.do',
	          	      type: 'post',
	          	        dataType: 'json',
	          	      cache: false,
	          	      'success': function(data){
			            	window.wxc.xcConfirm("注销成功",window.wxc.xcConfirm.typeEnum.success,
			                        {onClose: function(){
			                          window.location.href= "login.html?flag="+Math.random();
			                        }},
			                        {onOk: function(){
			                          window.location.href= "login.html?flag="+Math.random();
			                        }}); 
	          	      },
	          	      'error':function(data){
	          	        window.wxc.xcConfirm("注销失败",window.wxc.xcConfirm.typeEnum.error);
	          	      }
	          	    });
	            	
	            }});
	}
</script>
</body>
</html>