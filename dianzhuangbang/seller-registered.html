<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> 
  <meta name="keywords" content="店装帮">
  <meta name="description" content="店装帮，让店装更便捷" />
  <title>需求大厅</title>
  <link rel="shortcut icon" href="favicon.ico"/>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" type="text/css" href="css/Payeng.css">

</head>
<body class="p-user">

  <header class="t-header">     
    <div class="container-fluid p-nopadding t-top p-container">
        <span><a href="index.html"><img src="img/logo.png" alt="店装帮"></a><em>让店装更便捷</em></span>
        <ul class="list-inline pull-right p-nopadding t-ul">
            <li id="index_head"><a href="login.html">登录</a><a href="register.html">免费注册</a></li>
            <li class="p-paddingLeft8" id="showsysout"></li>
        </ul>            
    </div>   
  </header><!--end headr -->

  <nav class="navbar navbar-default t-nomargin t-navbar">
    <div class="container-fluid p-container p-nopadding ">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse p-nopadding" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav t-width100">
          <li class="dropdown t-background t-li">
            <a href="#" class="dropdown-toggle t-fontcolor6 c-dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><img src="img/nav-icon.png" alt="" class="t-por3 c-navicon">全部导航<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="index.html">首页<span class="icon-navshouye pull-right p-iconBefore"></span></a></li>
              <li role="separator" class="divider"></li>
              <li><a href="seller-list.html">找需求<span class="icon-navchuangkezhongxin pull-right p-iconBefore"></span></a></li>
              <li role="separator" class="divider"></li>
              <li><a href="stuff.html">找材料<span class="icon-navzhaocailiao pull-right p-iconBefore"></span></a></li>
              <li role="separator" class="divider"></li>
              <li><a href="maker.html">创客中心<span class="icon-navchuangkezhongxin pull-right p-iconBefore"></span></a></li>
            </ul>
          </li>
          <li><a href="index.html">首页</a></li>
          <li class="p-active"><a href="seller-list.html">找需求<img src="img/hothover.png" alt="" class="t-paddingLeft c-img"></a></li>
          <li><a href="stuff.html">找材料</a></li>
          <li><a href="maker.html">创客中心认证</a></li>
          <li class="pull-right"></li>
        </ul>
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav><!--end nav -->  


<div class="p-container p-margin5 p-marginTop">
	<div class="p2-backgroundwhite">
		<div class="media p2-padding4">
		  <div class="media-left media-middle p2-img p3-img">
		      <img class="media-object p2-marginBottom2" src="img/user-logo1.jpg" alt="" id="showIconImg2" >
		      <span id="showname"></span>
		  </div>
		  <div class="media-body" id="order_data_show">
		    <p>项目 : <span>项目<span class='p2-border8 pull-right'>待选中</span></p>
		    <p>预算 : <span class="p-fontcolor7">¥0元</span></p>
		    <h5>需求方要求 : </h5>
		    <p class="p-fontcolor8 p2-taj"></p>
		  </div>
		</div>
		<div class="p2-padding5" id="order_data_show3" >
		 </div>
		<div class="clearfix"></div>

		<div class="container-fluid text-center p2-bdb4">
			<ul class="col-xs-12 p-nowrap p-fons1 p-fontcolor8 col-sm-10 col-sm-offset-1">
				<li class="col-xs-2"><span class="glyphicon glyphicon-list-alt p-fontcolor2"></span><br> 填写任务信息</li>
				<li class="col-xs-2"><span class="glyphicon glyphicon-search p-fontcolor2"></span><br> 任务审核、验证</li>
				<li class="col-xs-2 p-nocolor"><span class="glyphicon glyphicon-user p-fontcolor2"></span><br> 匹配供应方</li>
				<li class="col-xs-2"><span class="glyphicon glyphicon-cog"></span><br> 供应方工作</li>
				<li class="col-xs-2"><span class="glyphicon glyphicon-ok"></span><br> 验收并付款</li>
				<li class="col-xs-2"><span class="glyphicon glyphicon-th-large"></span><br> 售后</li>
				<li class="col-xs-10 col-xs-offset-1 p-hr4 p-hr5"></li>
			</ul>
			<div class="clearfix"></div>
			<ol class="text-left" id="order_data_show2" >
				
			</ol>
		</div>
		<div class="clearfix"></div><!-- /menu -->

 		<div class="container-fluid col-md-8 col-md-offset-2 text-center p-marb2">	
			<button class="btn btn2 btn-primary p-margin6" onclick="alterOrderStatus();" >立即投递</button>
			<!--  
			<p class="p-fontcolor6">你今天可投选<span class="p-fontcolor2">6</span>个项目</p>
			-->
		</div>
	</div>
</div>
<div class="clearfix"></div><!-- /menu -->


<div class="container-fluid footer" id="footer1">
</div><!-- /footer -->



<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery-3.2.0.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/Payeng.js"></script>
<script>

	function GetQueryString(name)
	{
	     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	     var r = window.location.search.substr(1).match(reg);
	     if(r!=null)return  unescape(r[2]); return null;
	}
	
	$.ajax({
		url: '/DZBang_entrance/orderinfo/getuserinfoOrderbyorderno.do',
		type: 'post',
		data: {order_no:GetQueryString("orderno")},
		dataType: 'json',
		cache: false,
		'success': function(data){
			var str = "";
			str = str + "<p>项目 : <span>"+data.order_name+"<span class='p2-border8 pull-right'>待选中</span></p>";
			str = str + "<p>预算 : <span class='p-fontcolor7'>¥"+data.order_money+"元</span></p>";
			str = str + "<h5>需求方要求 : </h5>";
			str = str + "<p class='p-fontcolor8 p2-taj'>"+data.order_remark+"</p>";
			$("#order_data_show").html(str);
			
			var str3 = "";
			str3 = str3 + "<div class='p-padding2 p-inline-block2' id='ischeck'><span class='glyphicon glyphicon-ok p-fontsize2 p-fontcolor2'></span>实名已认证 &nbsp;</div>";
			str3 = str3 + "<div class='p-phone p-padding2 p-inline-block2 p-paddl4' id='checkphone'><span class='glyphicon glyphicon-ok p-fontsize2 p-fontcolor2'></span>手机已认证 &nbsp;</div>";
			str3 = str3 + "<p class='p-fontcolor8 pull-right p2-paddingTop4'><span class='p2-paddintRight2'><img src='img/icon-adress.png' alt=''>"+data.area+data.city+"</span> <span>截止日期："+data.end_date_str+"</span></p>";
			$("#order_data_show3").html(str3);
			
			var str2 = "";
			str2 = str2 + "<li>";
			str2 = str2 + "<dl class='dl-horizontal p2-dl'>";
			str2 = str2 + "	<dt>项目日期 : </dt>";
			str2 = str2 + "	<dd>起："+data.begin_date_str+"</dd>";
			str2 = str2 + "	<dd class='p2-marginLeft4'>止："+data.end_date_str+"</dd>";
			str2 = str2 + "</dl>";
			str2 = str2 + "</li>";
			str2 = str2 + "<li>";
			str2 = str2 + "<dl class='dl-horizontal p2-dl'>";
			str2 = str2 + "	<dt>具体描述 : </dt>";
			str2 = str2 + "	<dd class='p-dd80'>"+data.order_remark+"<br>";
			str2 = str2 + "	<p class='pull-right p2-nopadding'>"+data.created_date_str+"</p>";
			str2 = str2 + "	</dd>";
			str2 = str2 + "</dl>";
			str2 = str2 + "</li>";
			//str2 = str2 + "<li>";
			//str2 = str2 + "<dl class='dl-horizontal p2-dl'>";
			//str2 = str2 + "	<dt>后续补充 : </dt>";
			//str2 = str2 + "	<dd class='p-dd80'>"+data.order_remark+"<br>";
			//str2 = str2 + "	<p class='pull-right p2-nopadding'>"+data.created_date_str+"</p>";
			//str2 = str2 + "	</dd>";
			//str2 = str2 + "</dl>";
			//str2 = str2 + "</li>";
			str2 = str2 + "<li id='showattachmentdown'>";
			str2 = str2 + "<dl class='dl-horizontal p2-dl '>";
			str2 = str2 + "	<dt>附件说明 : </dt>";
			str2 = str2 + "	<dd class='p2-por2'>";
			str2 = str2 + "		<input type='text' id='downfile' name='downfile' value='' class='p2-button' disabled='disabled'>";
			str2 = str2 + "		<input type='hidden' id='attachmentid' name='attachmentid' value='''></input>";
			str2 = str2 + "		<a download='' onclick='downpdffile();' class='btn5 p-btnstyle3 p2-download' id='downPdf'>下载</a>";
			str2 = str2 + "	</dd>";
			str2 = str2 + "</dl>";
			str2 = str2 + "</li>";
			$("#order_data_show2").html(str2);
			
			$.ajax({
				url: '/DZBang_entrance/userinfo/getCreaditData.do',
				type: 'post',
				data: {id:data.creadit_id},
				dataType: 'json',
				cache: false,
				'success': function(createddata){
					console.log(createddata.name);
						$("#showname").html(createddata.name);
						$("#showIconImg2").attr("src","/DZBang_entrance/imgload.do?filePath=" + createddata.icon_img+"&flag="+Math.random());
						if(createddata.check_statue != '3'){
							$("#ischeck").html("<span class='glyphicon glyphicon-user p-fontsize2 p-fontcolor8'></span>实名未认证 &nbsp;");
						}
						if(createddata.phone == null || createddata.phone == ''){
							$("#checkphone").html("<span class='glyphicon glyphicon-phone p-fontsize2 p-fontcolor8'></span>手机未认证 &nbsp;");
						}

				},
				'error':function(data){
				}
			});
			
		},
		'error':function(data){
			window.wxc.xcConfirm("查询失败",window.wxc.xcConfirm.typeEnum.error);
		}
	});
	
	//查询附件
	$.ajax({
		url: '/DZBang_entrance/orderinfo/queryAttachment.do',
		type: 'post',
		data: {order_no:GetQueryString("orderno")},
		dataType: 'json',
		cache: false,
		'success': function(data){
			if(data != null && data != ""){
				$("#downfile").val(data.before_name);
				$("#attachmentid").val(data.id);
			}else{
				$("#showattachmentdown").css({display:'none'});
			}
			
		},
		'error':function(data){
			$("#showattachmentdown").css({display:'none'});
		}
	});
	
	//下载附件
	function downpdffile(){
	    var attachmentid = $("#attachmentid").val();
	    window.location.href='/DZBang_entrance/orderinfo/downPdfFile.do' + '?id=' + attachmentid;
	}
	
	function alterOrderStatus(){

		window.wxc.xcConfirm("请确认是否投递？",window.wxc.xcConfirm.typeEnum.confirm,
				{onOk: function(){
					var order_no = GetQueryString("orderno");
					
					$.ajax({
						url: '/DZBang_entrance/orderinfo/sendOrderMessage.do',
						type: 'post',
						data: {order_no:order_no},
						dataType: 'json',
						cache: false,
						'success': function(data){
							if("success" == data.result){
								window.wxc.xcConfirm("投递成功，请耐心等待结果",window.wxc.xcConfirm.typeEnum.success,
										{onClose: function(){
											window.location.href= "user-index.html?flag="+Math.random();
										}},
										{onOk: function(){
											window.location.href= "user-index.html?flag="+Math.random();
										}});
							}else if("nologin" == data.result){
								window.wxc.xcConfirm("你好，你还未登录，请先登录",window.wxc.xcConfirm.typeEnum.error,
										{onClose: function(){
											window.location.href= "login.html?flag="+Math.random();
										}},
										{onOk: function(){
											window.location.href= "login.html?flag="+Math.random();
										}});
							}else if("noservicer" == data.result){
								window.wxc.xcConfirm("你好，你不是服务方",window.wxc.xcConfirm.typeEnum.error);
							}else{
								window.wxc.xcConfirm("你好，保存失败，请重新提交",window.wxc.xcConfirm.typeEnum.error);
							}
						},
						'error':function(data){
							window.wxc.xcConfirm("查询失败",window.wxc.xcConfirm.typeEnum.error);
						},
			
					});
		
		}});
		
	}
</script>
<script>
  $.getJSON("/DZBang_entrance/happuser/getloginUser.do", function(data){
      if("" != data.name && null != data.name){
    	  $("#index_head").html('<a href="user-information.html" class="p-borderColor">'+data.nickname+'</a><a href="user-notice.html"><span class="p-fontcolor20">消息</span></a>');
          $("#showsysout").html("<a onclick='sysloginout();' >退出</ a>");

      }else{
    	  window.wxc.xcConfirm("你未登录，请先登录",window.wxc.xcConfirm.typeEnum.error,
  	            {onClose: function(){
  	              window.location.href= "login.html?flag="+Math.random();
  	            }},
  	            {onOk: function(){
  	              window.location.href= "login.html?flag="+Math.random();
  	            }});
      }
  });
  function sysloginout(){
	  window.wxc.xcConfirm("请确认是否注销？",window.wxc.xcConfirm.typeEnum.confirm,
	            {onOk: function(){
	            	$.ajax({
	          	      url: '/DZBang_entrance/syslogout.do',
	          	      type: 'post',
	          	        dataType: 'json',
	          	      cache: false,
	          	      'success': function(data){
			            	window.wxc.xcConfirm("注销成功",window.wxc.xcConfirm.typeEnum.success,
			                        {onClose: function(){
			                          window.location.href= "login.html?flag="+Math.random();
			                        }},
			                        {onOk: function(){
			                          window.location.href= "login.html?flag="+Math.random();
			                        }}); 
	          	      },
	          	      'error':function(data){
	          	        window.wxc.xcConfirm("注销失败",window.wxc.xcConfirm.typeEnum.error);
	          	      }
	          	    });
	            	
	            }});
	}
</script>
</body>
</html>