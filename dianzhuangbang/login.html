<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> 
    <meta name="keywords" content="店装帮">
 	<meta name="description" content="店装帮，让店装更便捷" />
	<title>登录</title>
	<link rel="shortcut icon" href="favicon.ico"/>
	<link rel="stylesheet" type="text/css" href="css/common.css" />
    <link rel="stylesheet" type="text/css" href="css/login.css" />
    
    <link href="css/bootstrap.min.css" rel="stylesheet">
  	<link rel="stylesheet" type="text/css" href="css/Payeng.css">
  	
  	<script src="js/jquery-3.2.0.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
    
	<script type="text/javascript" src="js/jquery.SuperSlide.2.1.1.js"></script>
	<script type="text/javascript" src="js/jquery.validate.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
	<script type="text/javascript" src="js/Payeng.js"></script>
	<style>
		.xcConfirm .popBox .sgBtn.cancel{display: none;}
		.xcConfirm .popBox .txtBox p{text-align: left;}
		.u-por{position: relative;left: -22px;}
		.xcConfirm .popBox .ttBox .clsBtn{display: none;}
	</style>

	<script>
$(function(){

	//登录切换
	(function(){
		$(".login_tab ul li").click(function(){
			var num = $(this).index();
			$(this).addClass('current').siblings().removeClass('current');
			if(num == 0){
				$('.login-form').show();
				$('.login_quick').hide();
			}else{
				$('.login-form').hide();
				$('.login_quick').show();
			}
		})
	})();
	//表单验证
	(function(){
		// 邮箱验证
		jQuery.validator.addMethod("isMobile", function(value, element) {
			// var length = value.length;
			 var mobile = /^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;
			// var mobile = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
			return this.optional(element) || mobile.test(value);
		}, "请正确填写您的手机号码");

		$('#login').validate({
			//验证成功后执行
			submitHandler : function (form) {
				window.wxc.xcConfirm("验证成功，准备提交！",window.wxc.xcConfirm.typeEnum.error);
			},
			rules : {
				userName : {
					required : true,
					//minlength : 11,
					isMobile:true,
					// email:true,
					remote:'/',  //验证用户名是否已存在
				},
				passWord : {
					required : true,
					minlength : 6,
					//验证用户名是否已存在
					remote : {
						url : '/',    //提交后台的地址
						type : 'POST',
						dataType : 'json',
						data : {
							userName : function () {
								return $('#userName').val();  //获取输入的内容
							},
						},
					},
				},
				pciYzm : {
					required : true,
					minlength : 4
				}
			},
			messages : {
				userName : {
					required : '帐号不得为空！',
					//minlength : '帐号不得小于11位！',
					isMobile : '请正确填写您的手机号码',
					// email:'请输入正确的邮箱地址！',
					remote : '该帐号被被占用！'   //验证用户名是否已存在
				},
				passWord : {
					required : '密码不得为空！',
					minlength : '密码不得小于6位！',
					remote : '帐号或密码不正确！' //验证账号与密码是否一致的提示
				},
				picYzm : {
					required : '验证码不能为空',
					minlength : '验证码不能低于4位'
				}
			},
			/*错误提示信息*/
			errorElement: 'sub',
			success: function(label) {
				label.text('').remove();
			}
		});
	})();

	function number2(){

	$('.p-btnlogin').click(function(event) {
		var userName = $("#userName").val();
		var passWord = $("#passWord").val();
		var code = "qq313596790fh"+userName+",fh,"+passWord+"QQ978336446fh"+",fh,"+$("#picYzm").val(); 
		$.ajax({
			url: '/DZBang_entrance/login_login',
			type: 'post',
	    	data: {KEYDATA:code,tm:new Date().getTime()},
	    	dataType: 'json',
			cache: false,
			'success': function(data){
				if("success" == data.result){
					//saveCookie();
					//window.location.href="main/index";
					window.location.href="index.html?flag="+Math.random();
				}else if("usererror" == data.result){
					window.wxc.xcConfirm("用户名或密码有误",window.wxc.xcConfirm.typeEnum.error);
				}else if("codeerror" == data.result){
					window.wxc.xcConfirm("验证码输入有误",window.wxc.xcConfirm.typeEnum.error);
				}else{
					window.wxc.xcConfirm("缺少参数,登录失败",window.wxc.xcConfirm.typeEnum.error);
				}
			},
			'error':function(data){
				window.wxc.xcConfirm("缺少参数,登录失败",window.wxc.xcConfirm.typeEnum.error);
			},

		});		
	});
	};
	number2();
})
// 登录验证end
	</script>

</head>

<body>
<!--头部-->
<div class="lr_header">
	<div class="lr_header_wrap wrap">
		<h1 class="logo p-marginT"><a href="index.html"><img src="img/logo.png" alt="店装帮"></a></h1>
		<a href="index.html" style="float:right;color:#0085d0;margin-top:54px;">返回首页</a>
	</div>
</div>
<!-- 登陆框  -->

<div class="login-main">
	<div class="login-wrap">
		<div class="login_tab">
			<ul>
				<li class="current">账户密码登录</li>
				<li>快捷登录</li>
			</ul>
		</div>
		<div class="login-form">
			<form action="" class="login-form-con" id="login">
				<div><input type="text" name="userName" id="userName" placeholder="请输入手机号码" maxlength="11" /></div>
				<div><input type="passWord" name="passWord" id="passWord" class="pswShow" placeholder="请输入密码" maxlength="16" minlength="6" /></div>
				<div>
					<input type="text" name="picYzm" id="picYzm" placeholder="请输入右侧图形码" maxlength="4" style="width:198px;" />
					<a href="javascript:void(0)" title="点击图片刷新校验码" class="p-validate"><img src="img/pic_yzm2.png" class="p-validate-img"></a>
				</div>
				<input type="submit" value="登录" class="login-btn btn01 p-btnlogin"/>
				<p style="text-align:right;margin-top:20px;color:#d2d2d2;"><a href="password-again.html">忘记密码</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="register.html" class="color01">注册新账户</a></p>
			</form>
		</div>
		<div class="login_quick login-form" >
			<form action="" class="login-form-con">
				<div>
					<input type="text" name="phone" id="phone" placeholder="请输入手机号码" maxlength="11" class="p-input" />
					<!-- <sub class="p-sub">手机号码格式不对</sub> -->
				</div>
				<div>
					<input type="text" name="qpicYzm" id="qpicYzm" placeholder="请输入右侧图形码" maxlength="4" style="width:198px;" class="p-input" />
					<a href="javascript:void(0)" title="点击图片刷新校验码" class="p-validate"><img src="img/pic_yzm2.png" class="p-validate-img"></a>
					<br>
					<!-- <sub class="p-sub">请输入正确的图形码</sub>	 -->
				</div>
				<div>
					<input type="text" name="qphoneYzm" id="qphoneYzm" placeholder="请输入验证码" maxlength="6" style="width:198px;"  class="btn-number p-btnNumber2 p-input" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^0-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^0-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"  />
					<a href="javascript:registSMS()" class="phone_yzm send c-send">获取验证码</a>
					<div class="clearfix"></div>
					<!-- <sub class="p-red p-sub3">请输入验证码</sub> -->
				</div>
				<input type="button" value="登录" class="login-btn btn01 c-submit"/>
				<p style="text-align:right;margin-top:20px;color:#d2d2d2;">&nbsp;&nbsp;<a href="register.html" class="color01">注册新账户</a></p>
			</form>
		</div>
	</div>
</div>

<script type="text/javascript" src="js/Payeng.js"></script>
<script>
	$(".c-submit").click(function(event) {

		if ($(".p-input:eq(0)").val() == '') {
			 window.wxc.xcConfirm('请输入正确的手机号码',window.wxc.xcConfirm.typeEnum.confirm);
		}else if( $(".p-input:eq(0)").val().length <11){
			window.wxc.xcConfirm('手机号码格式不对',window.wxc.xcConfirm.typeEnum.confirm);
		}else if( $(".p-input:eq(1)").val() == '' ||$(".p-input:eq(1)").val().length<4){
			window.wxc.xcConfirm('请输入正确的图形码',window.wxc.xcConfirm.typeEnum.confirm);
		}else if( $(".p-input:eq(2)").val() == ''|| $(".p-input:eq(2)").val().length<6){
			window.wxc.xcConfirm('请输入正确的验证码',window.wxc.xcConfirm.typeEnum.confirm);
		}else{
			
			queryLogin();
		};
	});
	
	function queryLogin(){
		var phone = $("#phone").val();
		var qpicYzm = $("#qpicYzm").val();
		var qphoneYzm = $("#qphoneYzm").val();
		$.ajax({
			url: '/DZBang_entrance/query_login',
			type: 'post',
	    	data: {phone:phone,qpicYzm:qpicYzm,qphoneYzm:qphoneYzm,tm:new Date().getTime()},
	    	dataType: 'json',
			cache: false,
			'success': function(data){
				if("success" == data.result && "yes" == data.ishave){
					window.location.href="index.html?flag="+Math.random();
				}else if("success" == data.result && "no" == data.ishave){
					showChooseStatue();
				}else if("notsendSMS" == data.result){
					window.wxc.xcConfirm("没有触发短信验证码",window.wxc.xcConfirm.typeEnum.error);
				}else if("notsendPicCode" == data.result){
					window.wxc.xcConfirm("没有触发图形码",window.wxc.xcConfirm.typeEnum.error);
				}else if("phoneYzmError" == data.result){
					window.wxc.xcConfirm("短信验证码输入有误",window.wxc.xcConfirm.typeEnum.error);
				}else if("codeError" == data.result){
					window.wxc.xcConfirm("图形验证码输入有误",window.wxc.xcConfirm.typeEnum.error);
				}else{
					window.wxc.xcConfirm("快捷登录失败",window.wxc.xcConfirm.typeEnum.error);
				}
			},
			'error':function(data){
				window.wxc.xcConfirm("缺少参数,登录失败",window.wxc.xcConfirm.typeEnum.error);
			},

		});	
	}
	
	function showChooseStatue(){
		
		var text = '<span style="margin-left:131px;font-size:18px;position:relative; top:-20px;">接下来你想成为</span></br><input type="radio" name="statue" value="1" checked="checked" class="statue" checked="checked" style="margin-left:119px; position:relative; top:3px; margin-right:0px;"/>发需求 <input type="radio"  name="statue" value="2" class="statue" style=" position:relative; top:3px;margin-left:10px;"/>接需求';
		var txt=  text;
		var option = {
			title: "提醒",
			btn: parseInt("0011",2),
			onOk: function(){
				var statue = $('input[name="statue"]:checked ').val();
				updateUserStatus(statue);
			}
		}
		window.wxc.xcConfirm(txt, "custom", option);
	};

	function registSMS(){
		var phone = $("#phone").val();
		if(phone == ''){
			window.wxc.xcConfirm("手机号码不能为空",window.wxc.xcConfirm.typeEnum.error);
			return;
		}
		$.ajax({
			url: '/DZBang_entrance/smsCode/registerSMSCode.do',
			type: 'post',
	    	data: {phone:phone,tm:new Date().getTime()},
	    	dataType: 'json',
			cache: false,
			'success': function(data){
				if(data.result == "success"){
					window.wxc.xcConfirm("短信发送成功",window.wxc.xcConfirm.typeEnum.success);
				}else if(data.result == "error"){
					window.wxc.xcConfirm("短信发送失败",window.wxc.xcConfirm.typeEnum.error);
				}else{
					window.wxc.xcConfirm("短信发送异常",window.wxc.xcConfirm.typeEnum.error);
				}
			},
			'error':function(data){
				window.wxc.xcConfirm("短信发送失效",window.wxc.xcConfirm.typeEnum.error);
			}
		});
	}
	
	function updateUserStatus(statue){
		$.ajax({
			url: '/DZBang_entrance/happuser/updateUserStatus.do',
			type: 'post',
	    	data: {statue:statue,tm:new Date().getTime()},
	    	dataType: 'json',
			cache: false,
			'success': function(data){
				if(data.result == "success"){
					window.location.href="index.html?flag="+Math.random();
				}else if(data.result == "error"){
					window.wxc.xcConfirm("选择类型错误",window.wxc.xcConfirm.typeEnum.error);
				}else{
					window.wxc.xcConfirm("选择类型错误",window.wxc.xcConfirm.typeEnum.error);
				}
			},
			'error':function(data){
				window.wxc.xcConfirm("选择类型错误",window.wxc.xcConfirm.typeEnum.error);
			}
		});
	}
	
</script>
</body>
</html>
