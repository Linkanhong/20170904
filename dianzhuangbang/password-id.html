<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> 
  <meta name="keywords" content="店装帮">
  <meta name="description" content="店装帮，让店装更便捷" />
  <title>找回密码</title>
  <link rel="shortcut icon" href="favicon.ico"/>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/Payeng.css">
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" type="text/css" href="css/user.css">

</head>
<body >
  <header class="t-header">     
    <div class="container-fluid p-nopadding t-top p-container">
        <span><a href="index.html"><img src="img/logo.png" alt="店装帮"></a><em>让店装更便捷</em></span>
        <ul class="list-inline pull-right p-nopadding t-ul">
            <li id="index_head"><a href="login.html">登录</a><a href="register.html">免费注册</a></li>
            <li class="p-paddingLeft8" id="showsysout"></li>
        </ul>            
    </div>   
  </header><!--end headr -->

  <nav class="navbar navbar-default t-nomargin t-navbar">
    <div class="container-fluid p-container p-nopadding ">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse p-nopadding" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav t-width100">
          <li class="dropdown t-background t-li">
            <a href="#" class="dropdown-toggle t-fontcolor6 c-dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><img src="img/nav-icon.png" alt="" class="t-por3 c-navicon">全部导航<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="index.html">首页<span class="icon-navshouye pull-right p-iconBefore"></span></a></li>
              <li role="separator" class="divider"></li>
              <li><a href="seller-list.html">找需求<span class="icon-navchuangkezhongxin pull-right p-iconBefore"></span></a></li>
              <li role="separator" class="divider"></li>
              <li><a href="stuff.html">找材料<span class="icon-navzhaocailiao pull-right p-iconBefore"></span></a></li>
              <li role="separator" class="divider"></li>
              <li><a href="maker.html">创客中心<span class="icon-navchuangkezhongxin pull-right p-iconBefore"></span></a></li>
            </ul>
          </li>
          <li><a href="user-information.html">账户设置</a></li>
          <li><a href="uese-myMember.html">会员中心</a></li>
          <li><a href="user-notice.html">消息中心</a></li>
          <li></li>
        </ul>
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav><!--end nav -->  

<div class="container-fluid text-center p-container p-nopadding u-margin">
	<div class="jumbotron">
	  <ol class="breadcrumb text-left">
		  <li><a href="index.html">首页</a></li>
		  <li class="active">验证身份</li>
	  </ol>
	  <ul class="list-inline p-ul col-md-8 col-md-offset-2">
	  	<li class="col-md-3"> <span class="p-background">1</span> <br>填写账号</li>
	  	<li class="col-md-3 p-nocolor"> <span class="p-background">2</span> <br>验证身份</li>
	  	<li class="col-md-3"> <span>3</span> <br>重罝密码</li>
	  	<li class="col-md-3"> <span>4</span> <br>找回成功</li>
	  </ul>
	  <div class="clearfix"></div>
	  <p class="p-color2">根据您的账号情况，可选择通过以下验证方式找回密码</p>
	  <ul class="list-inline  p-glyphicon">
	  	<li><span class="glyphicon glyphicon-user text-left p-border"></span></li>
	  	<li class="text-left p-margl">
	  		通过登录名找回 <br> 
	  		<div id="showPhone" class="p-paddintTop"></div> 
	  	</li>
	  </ul>
	  <!-- 手机验证码		   -->
	  <div class="col-md-12 p2-marginBottom6">
	  	<div id="">
	    	<label for="" class="col-sm-4 control-label"></label>
	    </div>
	    <div class="col-sm-4">
	      <input type="tel" class="form-control p-input2" id="modifyPwCode" name="modifyPwCode" placeholder="验证码" maxlength="6"
		    onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^0-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^0-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" />
		    <a href="javascript:void(0)" onclick="modifyPwSMS();" class="send p-send3 form-control-feedback p-form-feedback p-poaR">获取验证码</a>	
	    </div>
	  </div>
	  <div class="clearfix"></div>	  
	  <p class="text-center"><a class="btn btn-primary p-btn1" onclick="oncheck();" role="button">立即验证</a></p>
	</div>
</div><!-- /content -->

<div class="container-fluid footer" id="footer1">
</div><!-- /footer -->



<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery-3.2.0.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/Payeng.js"></script>
<script>
	var thisURL = document.URL;
	var  getval =thisURL.split('?')[1];
	var showval= getval.split("=")[1];
	/*
	function  showvalf(){
	   //document.getElementById('ee').value=showval; 
	   $("#showPhone").html(GetQueryString("phone"));
	}
	*/
	$(function() {
		$("#showPhone").html(GetQueryString("phone"));
    })
	
	
	function GetQueryString(name)
	{
	     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	     var r = window.location.search.substr(1).match(reg);
	     if(r!=null)return  unescape(r[2]); return null;
	}
	

	function oncheck(){
		var phone = $("#showPhone").html();
		var modifyPwCode = $("#modifyPwCode").val();
		$.ajax({
			url: '/DZBang_entrance/happuser/hasPhone.do',
			type: 'post',
	    	data: {modifyPwCode:modifyPwCode,PHONE:phone,tm:new Date().getTime()},
	    	dataType: 'json',
			cache: false,
			'success': function(data){
				if(data.result = "yes"){
					window.location.href= "password-reset.html?userid="+data.userid+"&phone="+ phone + "&flag="+Math.random();
				}else if(data.result = "noModifyCode"){
					window.wxc.xcConfirm("没有输入短信验证码",window.wxc.xcConfirm.typeEnum.error);
				}else if(data.result = "notSendSms"){
					window.wxc.xcConfirm("没有触发短信验证码",window.wxc.xcConfirm.typeEnum.error);
				}else if(data.result = "buyiyang" ){
					window.wxc.xcConfirm("短信验证码错误",window.wxc.xcConfirm.typeEnum.error);
				}else{
					window.wxc.xcConfirm("修改密码错误",window.wxc.xcConfirm.typeEnum.error);
					window.location.href= "password-again.html" + "?flag="+Math.random();
				}
			},
			'error':function(data){
			}
		});
	};
	
	function modifyPwSMS(){
		var phone = $("#showPhone").html();
		if(phone == ''){
			window.wxc.xcConfirm("手机号码不能为空",window.wxc.xcConfirm.typeEnum.error);
			return;
		}
		$.ajax({
			url: '/DZBang_entrance/smsCode/modifyPwSMSCode.do',
			type: 'post',
	    	data: {phone:phone,tm:new Date().getTime()},
	    	dataType: 'json',
			cache: false,
			'success': function(data){
				if(data.result == "success"){
					window.wxc.xcConfirm("短信发送成功",window.wxc.xcConfirm.typeEnum.success);
				}else if(data.result == "error"){
					window.wxc.xcConfirm("短信发送失败",window.wxc.xcConfirm.typeEnum.error);
				}else{
					window.wxc.xcConfirm("短信发送异常",window.wxc.xcConfirm.typeEnum.error);
				}
			},
			'error':function(data){
				window.wxc.xcConfirm("短信发送失效",window.wxc.xcConfirm.typeEnum.error);
			}
		});
	}
</script>
</body>
</html>